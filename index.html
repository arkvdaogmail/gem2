<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>V-DAO Notary (Final Test)</title>
    <script src="https://unpkg.com/@vechain/connex@2.1.0/dist/connex.min.js"></script>
</head>
<body>
    <h1>V-DAO Notary</h1>
    <p>This is the final test. Please open your browser's developer console to see error messages.</p>
    <input type="file" id="fileInput">
    <button id="notarizeBtn">Notarize</button>
    <div id="result"></div>

    <script>
        document.getElementById('notarizeBtn').addEventListener('click', async () => {
            const resultDiv = document.getElementById('result');
            const file = document.getElementById('fileInput').files[0];

            if (!file) {
                resultDiv.innerText = 'Error: Please select a file.';
                return;
            }

            if (!window.connex) {
                resultDiv.innerText = 'Error: VeChain wallet not found.';
                return;
            }

            resultDiv.innerText = 'Working...';
            
            try {
                const fileBuffer = await file.arrayBuffer();
                const hashBuffer = await crypto.subtle.digest('SHA-256', fileBuffer);
                const hash = '0x' + Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');

                const { txid } = await connex.vendor.sign('tx', [{ to: null, value: '0x0', data: hash }]).request();

                resultDiv.innerHTML = `Success! TXID: ${txid}`;
            } catch (error) {
                console.error("CRITICAL ERROR:", error);
                resultDiv.innerText = `Error: ${error.message}. Check console for details.`;
            }
        });
    </script>
</body>
</html>
